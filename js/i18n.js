// js/i18n.js
// This file centralizes all logic related to language and translations, making it easy to add more languages or change text in the future.
/**
 * The main object holding all translation strings for different languages.
 */
export const translations = {
    en: {
        appTitle: "Las Tres Amigas",
        navScheduler: '<i class="fas fa-calendar-alt"></i> Scheduler',
        navEmployees: '<i class="fas fa-users"></i> Employees',
        navRoles: '<i class="fas fa-user-tag"></i> Roles/Positions',
        navDepartments: '<i class="fas fa-building"></i> Departments',
        navShifts: '<i class="fas fa-clock"></i> Shift Templates',
        navSettings: '<i class="fas fa-cog"></i> Settings',
        navExit: '<i class="fas fa-sign-out-alt"></i> Log Out',
        btnThisWeek: '<i class="fas fa-calendar-day"></i> This Week',
        btnPrevWeek: '<i class="fas fa-arrow-left"></i> Prev',
        btnNextWeek: 'Next <i class="fas fa-arrow-right"></i>',
        optAllDepts: 'All Departments',
        optSelectDept: '-- Select Department --',
        optGeneral: 'General',
        optNoDept: 'No Department Assigned',
        btnPrint: '<i class="fas fa-print"></i> Print',
        lblCopyWeek: 'Copy Week:',
        btnCopyWeek: '<i class="fas fa-copy"></i> Copy Week',
        btnManageEvents: 'Manage Events',
        btnClearWeek: '<i class="fas fa-calendar-times"></i> Clear Week',
        btnClearCopied: '<i class="fas fa-times-circle"></i> Clear Copied Shift',
        lblLanguage: 'Language:',
        headerEmployee: 'Employee <span class="hours-header">(Hrs)</span>',
        dayMon: 'Mon', dayTue: 'Tue', dayWed: 'Wed', dayThu: 'Thu', dayFri: 'Fri', daySat: 'Sat', daySun: 'Sun',
        modalAssignTitle: 'Assign Shift / Time Off',
        lblCopied: 'Copied:',
        btnPasteHere: '<i class="fas fa-paste"></i> Paste Here',
        btnAssignNew: 'Assign New Instead',
        lblAssignmentType: 'Assignment Type:',
        btnFromTemplate: 'From Template',
        btnCustomShift: 'Custom Shift',
        btnTimeOff: 'Time Off',
        lblFilterDept: 'Filter Department:',
        lblSelectShiftTemplate: 'Select Shift Template:',
        lblStartTime: 'Start Time:',
        lblEndTime: 'End Time:',
        lblSaveAsTemplate: 'Save as new template?',
        lblTemplateName: 'Template Name:',
        phTemplateName: 'e.g., Custom Lunch Shift',
        lblReason: 'Reason:',
        optVacation: 'Vacation',
        optSick: 'Sick Leave',
        optPersonal: 'Personal Day',
        optUnpaid: 'Unpaid Time Off',
        lblAssignRole: 'Assign Role/Position:',
        btnAssignShift: 'Assign Shift',
        modalConflictTitle: 'Schedule Conflict',
        btnOverwrite: 'Overwrite',
        btnMerge: 'Merge',
        btnKeepExisting: 'Keep Existing',
        modalCopyEmployeeDesc: "Select any date within the source week you want to copy the schedule from.",
        lblSourceWeek: 'Source Week:',
        btnCopySchedule: 'Copy Schedule',
        modalManageEventsTitle: 'Manage Events',
        lblDate: 'Date:',
        lblEventName: 'Event Name:',
        phEventName: 'e.g., Independence Day Parade',
        btnAddEvent: '<i class="fas fa-plus"></i> Add Event',
        hdrScheduledEvents: 'Scheduled Events:',
        headerManageEmployees: '<i class="fas fa-users"></i> Manage Employees',
        hdrAddEmployee: 'Add New Employee',
        hdrEditEmployee: 'Edit Employee',
        hdrPersonalDetails: "Personal Details",
        lblFirstName: "First Name:", phFirstName: "e.g., Jane",
        lblLastName: "Last Name:", phLastName: "e.g., Doe",
        lblDisplayName: "Display Name:", phDisplayName: "e.g., Jane D.",
        lblDob: "Date of Birth:",
        lblTelephone: "Telephone:",
        lblEmail: "E-mail:", phEmail: "e.g., jane.d@email.com",
        hdrAddress: "Address",
        lblAddress1: "Address 1:",
        lblAddress2: "Address 2:",
        lblCity: "City:",
        lblStateDept: "Department:",
        lblCountry: "Country:",
        hdrEmploymentDetails: "Employment Details",
        lblDept: "Department:",
        lblStartDate: "Start Date:",
        lblVacationDays: "Vacation Days:",
        lblTermDate: "Termination Date:",
        lblReasonLeaving: "Reason for Leaving:",
        optActiveEmployee: "-- Active Employee --",
        btnAddEmployee: "Add Employee",
        btnCancelEdit: "Cancel Edit",
        lblFilterByDept: "Filter by Department:",
        hdrCurrentEmployees: "Current Employees:",
        headerManageRoles: '<i class="fas fa-user-tag"></i> Manage Roles/Positions',
        lblRoleName: "Role Name:", phRoleName: "e.g., Server, Chef",
        lblRoleColor: "Role Color:",
        btnAddRole: "Add Role",
        hdrAvailableRoles: "Available Roles:",
        headerManageDepts: '<i class="fas fa-building"></i> Manage Departments',
        lblDeptName: "Department Name:", phDeptName: "e.g., Front of House, Kitchen",
        phDeptAbbr: "e.g., FOH, BOH",
        btnAddDept: "Add Department",
        hdrAvailableDepts: "Available Departments:",
        headerManageShiftTemplates: '<i class="fas fa-clock"></i> Manage Shift Templates',
        phShiftTemplateName: "e.g., Morning Shift",
        btnAddShiftTemplate: "Add Shift Template",
        headerSettings: '<i class="fas fa-cog"></i> Application Settings',
        hdrDisplaySettings: "Display Settings",
        headerRestaurantHours: '<i class="fas fa-concierge-bell"></i> Restaurant &amp; Meal Hours',
        hdrDailyHours: "Restaurant & Meal Hours",
        hdrMinCoverage: "Minimum Coverage Requirements",
        lblMinCoverageHelp: "Set the minimum staff for key periods. This determines the color-coding in the Coverage Summary.",
        hdrMealCoverageCalc: "Meal Coverage Calculation",
        lblMealCoverageDur: "Count employee if they work at least:",
        opt30mins: "30 minutes",
        opt1hour: "1 hour",
        opt90mins: "90 minutes",
        lblDuringMealPeriod: " during a meal period.",
        btnSaveChanges: '<i class="fas fa-save"></i> Save Changes',
        headerDataMgmt: '<i class="fas fa-database"></i> Data Management',
        hdrFullBackup: "Full Backup",
        btnBackupAll: '<i class="fas fa-download"></i> Backup All Data',
        lblFullBackupHelp: "Saves a single file with all your settings and schedules.",
        hdrSelectiveBackup: "Selective Backup",
        lblCategory: "Category:",
        optSchedules: "Schedules",
        optEmployees: "Employees",
        optRoles: "Roles",
        optDepts: "Departments",
        optShiftTemplates: "Shift Templates",
        optAppSettings: "Restaurant Settings",
        btnBackupSelected: '<i class="fas fa-download"></i> Backup Selected',
        hdrRestore: "Restore from File",
        btnChooseFile: "Choose Restore File...",
        lblNoFileChosen: "No file chosen.",
        lblRestoreHelp: "<strong>Important:</strong> Restoring will overwrite data. The app will detect if it's a full or partial backup and ask for confirmation.",
        hdrDangerZone: "Danger Zone",
        btnClearCache: '<i class="fas fa-trash-alt"></i> Clear Cache & Log Out',
        lblClearAllHelp: "Clears the application's local cache in your browser. You will be logged out, and data will be re-synced from the cloud upon your next login.",
        alertDeptNameEmpty: 'Department name and abbreviation cannot be empty.',
        confirmDeleteDept: 'Are you sure you want to delete this department? This will also remove it from any users, roles, or shifts assigned to it.',
        headerCoverageSummary: "Coverage Summary",
        lblOpen: "Open:", lblLunch: "Lunch:", lblDinner: "Dinner:", lblClose: "Close:",
        lblMinOp: "Min Opening:", lblMinLunch: "Min Lunch:", lblMinDinner: "Min Dinner:", lblMinClose: "Min Closing:",
        optDefault: "Default",
        modalClearWeekTitle: "Confirm Schedule Deletion",
        btnClearShiftsOnly: "Clear Shifts Only",
        btnClearEverything: "Clear Everything",
        btnCancel: "Cancel",
    },
    es: {
        appTitle: "Las Tres Amigas",
        navScheduler: '<i class="fas fa-calendar-alt"></i> Horario',
        navEmployees: '<i class="fas fa-users"></i> Empleados',
        navRoles: '<i class="fas fa-user-tag"></i> Roles/Puestos',
        navDepartments: '<i class="fas fa-building"></i> Departamentos',
        navShifts: '<i class="fas fa-clock"></i> Plantillas de Turno',
        navSettings: '<i class="fas fa-cog"></i> Ajustes',
        navExit: '<i class="fas fa-sign-out-alt"></i> Cerrar Sesión',
        btnThisWeek: '<i class="fas fa-calendar-day"></i> Esta Semana',
        btnPrevWeek: '<i class="fas fa-arrow-left"></i> Ant',
        btnNextWeek: 'Sig <i class="fas fa-arrow-right"></i>',
        optAllDepts: 'Todos los Deptos',
        optSelectDept: '-- Seleccione Depto --',
        optGeneral: 'General',
        optNoDept: 'Sin Departamento Asignado',
        btnPrint: '<i class="fas fa-print"></i> Imprimir',
        lblCopyWeek: 'Copiar Semana:',
        btnCopyWeek: '<i class="fas fa-copy"></i> Copiar Semana',
        btnManageEvents: 'Gestionar Eventos',
        btnClearWeek: '<i class="fas fa-calendar-times"></i> Limpiar Semana',
        btnClearCopied: '<i class="fas fa-times-circle"></i> Limpiar Copiado',
        lblLanguage: 'Idioma:',
        headerEmployee: 'Empleado <span class="hours-header">(Hrs)</span>',
        dayMon: 'Lun', dayTue: 'Mar', dayWed: 'Mié', dayThu: 'Jue', dayFri: 'Vie', daySat: 'Sáb', daySun: 'Dom',
        modalAssignTitle: 'Asignar Turno / Ausencia',
        lblCopied: 'Copiado:',
        btnPasteHere: '<i class="fas fa-paste"></i> Pegar Aquí',
        btnAssignNew: 'Asignar Nuevo',
        lblAssignmentType: 'Tipo de Asignación:',
        btnFromTemplate: 'Desde Plantilla',
        btnCustomShift: 'Turno Manual',
        btnTimeOff: 'Ausencia',
        lblFilterDept: 'Filtrar Depto:',
        lblSelectShiftTemplate: 'Seleccionar Plantilla de Turno:',
        lblStartTime: 'Hora de Inicio:',
        lblEndTime: 'Hora de Fin:',
        lblSaveAsTemplate: '¿Guardar como nueva plantilla?',
        lblTemplateName: 'Nombre de Plantilla:',
        phTemplateName: 'ej., Turno de Almuerzo',
        lblReason: 'Motivo:',
        optVacation: 'Vacaciones',
        optSick: 'Licencia Médica',
        optPersonal: 'Día Personal',
        optUnpaid: 'Ausencia sin Sueldo',
        lblAssignRole: 'Asignar Rol/Puesto:',
        btnAssignShift: 'Asignar Turno',
        modalConflictTitle: 'Conflicto de Horario',
        btnOverwrite: 'Sobrescribir',
        btnMerge: 'Fusionar',
        btnKeepExisting: 'Mantener Existente',
        modalCopyEmployeeDesc: "Seleccione cualquier fecha dentro de la semana de origen de la que desea copiar el horario.",
        lblSourceWeek: 'Semana de Origen:',
        btnCopySchedule: 'Copiar Horario',
        modalManageEventsTitle: 'Gestionar Eventos',
        lblDate: 'Fecha:',
        lblEventName: 'Nombre del Evento:',
        phEventName: 'ej., Desfile de Independencia',
        btnAddEvent: '<i class="fas fa-plus"></i> Añadir Evento',
        hdrScheduledEvents: 'Eventos Programados:',
        headerManageEmployees: '<i class="fas fa-users"></i> Gestionar Empleados',
        hdrAddEmployee: 'Añadir Nuevo Empleado',
        hdrEditEmployee: 'Editar Empleado',
        hdrPersonalDetails: "Detalles Personales",
        lblFirstName: "Nombre:", phFirstName: "ej., Maria",
        lblLastName: "Apellido:", phLastName: "ej., Garcia",
        lblDisplayName: "Nombre a Mostrar:", phDisplayName: "ej., Maria G.",
        lblDob: "Fecha de Nacimiento:",
        lblTelephone: "Teléfono:",
        lblEmail: "Correo Electrónico:", phEmail: "ej., maria.g@email.com",
        hdrAddress: "Dirección",
        lblAddress1: "Dirección 1:",
        lblAddress2: "Dirección 2:",
        lblCity: "Ciudad:",
        lblStateDept: "Departamento:",
        lblCountry: "País:",
        hdrEmploymentDetails: "Detalles de Empleo",
        lblDept: "Departamento:",
        lblStartDate: "Fecha de Inicio:",
        lblVacationDays: "Días de Vacaciones:",
        lblTermDate: "Fecha de Terminación:",
        lblReasonLeaving: "Motivo de Salida:",
        optActiveEmployee: "-- Empleado Activo --",
        btnAddEmployee: "Añadir Empleado",
        btnCancelEdit: "Cancelar Edición",
        lblFilterByDept: "Filtrar por Depto:",
        hdrCurrentEmployees: "Empleados Actuales:",
        headerManageRoles: '<i class="fas fa-user-tag"></i> Gestionar Roles/Puestos',
        lblRoleName: "Nombre de Rol:", phRoleName: "ej., Mesero, Cocinero",
        lblRoleColor: "Color de Rol:",
        btnAddRole: "Añadir Rol",
        hdrAvailableRoles: "Roles Disponibles:",
        headerManageDepts: '<i class="fas fa-building"></i> Gestionar Departamentos',
        lblDeptName: "Nombre de Depto:", phDeptName: "ej., Salón, Cocina",
        phDeptAbbr: "ej., SAL, COC",
        btnAddDept: "Añadir Depto",
        hdrAvailableDepts: "Departamentos Disponibles:",
        headerManageShiftTemplates: '<i class="fas fa-clock"></i> Gestionar Plantillas de Turno',
        phShiftTemplateName: "ej., Turno de Mañana",
        btnAddShiftTemplate: "Añadir Plantilla de Turno",
        headerSettings: '<i class="fas fa-cog"></i> Ajustes de Aplicación',
        hdrDisplaySettings: "Ajustes de Pantalla",
        headerRestaurantHours: '<i class="fas fa-concierge-bell"></i> Horario del Restaurante y Comidas',
        hdrDailyHours: "Horario del Restaurante y Comidas",
        hdrMinCoverage: "Requisitos Mínimos de Cobertura",
        lblMinCoverageHelp: "Establezca el personal mínimo para los períodos clave. Esto determina el color en el Resumen de Cobertura.",
        hdrMealCoverageCalc: "Cálculo de Cobertura de Comida",
        lblMealCoverageDur: "Contar empleado si trabaja al menos:",
        opt30mins: "30 minutos",
        opt1hour: "1 hora",
        opt90mins: "90 minutos",
        lblDuringMealPeriod: " durante un período de comida.",
        btnSaveChanges: '<i class="fas fa-save"></i> Guardar Cambios',
        headerDataMgmt: '<i class="fas fa-database"></i> Gestión de Datos',
        hdrFullBackup: "Copia de Seguridad Completa",
        btnBackupAll: '<i class="fas fa-download"></i> Respaldar Todo',
        lblFullBackupHelp: "Guarda un solo archivo con todos sus ajustes y horarios.",
        hdrSelectiveBackup: "Copia de Seguridad Selectiva",
        lblCategory: "Categoría:",
        optSchedules: "Horarios",
        optEmployees: "Empleados",
        optRoles: "Roles",
        optDepts: "Departamentos",
        optShiftTemplates: "Plantillas de Turno",
        optAppSettings: "Ajustes del Restaurante",
        btnBackupSelected: '<i class="fas fa-download"></i> Respaldar Selección',
        hdrRestore: "Restaurar desde Archivo",
        btnChooseFile: "Elegir Archivo...",
        lblNoFileChosen: "Ningún archivo elegido.",
        lblRestoreHelp: "<strong>Importante:</strong> Restaurar sobrescribirá los datos. La aplicación detectará si es una copia completa o parcial y pedirá confirmación.",
        hdrDangerZone: "Zona de Peligro",
        btnClearCache: '<i class="fas fa-trash-alt"></i> Limpiar Caché y Salir',
        lblClearAllHelp: "Limpia la memoria caché local de la aplicación en su navegador. Se cerrará su sesión y los datos se volverán a sincronizar desde la nube en su próximo inicio de sesión.",
        alertDeptNameEmpty: 'El nombre y la abreviatura del departamento no pueden estar vacíos.',
        confirmDeleteDept: '¿Está seguro de que desea eliminar este departamento? Esto también lo eliminará de cualquier usuario, rol, o turno asignado.',
        headerCoverageSummary: "Resumen de Cobertura",
        lblOpen: "Abre:", lblLunch: "Almuerzo:", lblDinner: "Cena:", lblClose: "Cierra:",
        lblMinOp: "Mín. Apertura:", lblMinLunch: "Mín. Almuerzo:", lblMinDinner: "Mín. Cena:", lblMinClose: "Mín. Cierre:",
        optDefault: "Por Defecto",
        modalClearWeekTitle: "Confirmar Eliminación de Horario",
        btnClearShiftsOnly: "Limpiar Solo Turnos",
        btnClearEverything: "Limpiar Todo",
        btnCancel: "Cancelar",
    }
};

/**
 * Gets a translated string for a given key. Falls back to English if the key is not found.
 * @param {string} key - The key of the string to translate.
 * @returns {string} The translated string.
 */
export function getTranslatedString(key) {
    const lang = localStorage.getItem('selectedLanguage') || 'en';
    return (translations[lang] && translations[lang][key]) ? translations[lang][key] : (translations.en[key] || key);
}

/**
 * Applies translations to all elements with a 'data-lang-key' attribute.
 * NOTE: This function only translates static text. Dynamically generated components
 * must be re-rendered by their respective modules to apply language changes.
 * @param {string} lang - The language to switch to (e.g., 'en', 'es').
 */
export function setLanguage(lang) {
    localStorage.setItem('selectedLanguage', lang);

    document.querySelectorAll('[data-lang-key]').forEach(element => {
        const key = element.getAttribute('data-lang-key');
        const translation = getTranslatedString(key);

        if (translation) {
            // Handle placeholders
            if (element.placeholder !== undefined) {
                element.placeholder = translation.replace(/<[^>]*>?/gm, ''); // Strip HTML for placeholders
            }

            // Handle elements that can contain HTML
            const elementTag = element.tagName.toLowerCase();
            if (['button', 'h1', 'h2', 'h3', 'h4', 'h5', 'p', 'span', 'label', 'small', 'option', 'strong'].includes(elementTag) || element.classList.contains('header-employee') || element.classList.contains('tab-link')) {
                // If translation contains HTML tags, use innerHTML. Otherwise, use textContent for security.
                if (translation.includes('<')) {
                    element.innerHTML = translation;
                } else {
                    element.textContent = translation;
                }
            }
        }
    });

    // It is the responsibility of the calling function in main.js
    // to re-render dynamic components like the schedule or department lists.
}